<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
  <meta charset="utf-8">
  <style>
    body { display: flex; height: 100%; margin: 0; }
    #container { flex: 1; }
    #controls { width: 200px; padding: 20px; box-sizing: border-box; background: #f5f5f5; }
  </style>
</head>
<body>
  <div id="container"></div>
  <div id="controls">
    <h3>Filtros</h3>
    <label><input type="checkbox" id="positivo" checked> Positivos</label><br>
    <label><input type="checkbox" id="negativo" checked> Negativos</label>
  </div>

  <script src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script>
    var anos = [2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024];
    var variacoes = [0, -91.7, -83.5, 553.3, -266.9, 93.4, -202.8, 550.1, -473.0, -87.4];

    var dom = document.getElementById('container');
    var myChart = echarts.init(dom);

    function renderChart() {
      var showPos = document.getElementById('positivo').checked;
      var showNeg = document.getElementById('negativo').checked;

      var cores = variacoes.map(v => {
        if (v >= 0 && showPos) return '#37A2FF';
        if (v < 0 && showNeg) return '#FF4C4C';
        return '#eeeeee'; // fora do filtro fica cinza
      });

      var option = {
        title: {
          text: 'Variação da chuva acumulada por ano (2015 a 2024) - Fazenda Carnaúba - Taperoá - PB',
          left: 'center'
        },
        tooltip: {
          trigger: 'axis',
          formatter: function(params) {
            var item = params[0];
            return `Ano: ${item.axisValue}<br>Variação: ${item.data} mm`;
          }
        },
        toolbox: {
          feature: {
            saveAsImage: {},
            dataZoom: {}
          }
        },
        xAxis: {
          type: 'category',
          data: anos
        },
        yAxis: {
          type: 'value',
          name: 'mm'
        },
        dataZoom: [
          { type: 'inside', start: 0, end: 100 },
          { start: 0, end: 100 }
        ],
        series: [
          {
            type: 'bar',
            name: 'Variação de chuva',
            data: variacoes,
            itemStyle: {
              borderRadius: 5,
              color: function(params) { return cores[params.dataIndex]; }
            }
          }
        ]
      };

      myChart.setOption(option);
    }

    document.getElementById('positivo').addEventListener('change', renderChart);
    document.getElementById('negativo').addEventListener('change', renderChart);

    renderChart();
    window.addEventListener('resize', myChart.resize);
  </script>
</body>
</html>
